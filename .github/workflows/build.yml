name: Build and Test MainRepo1

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
  workflow_dispatch: # Allows manual triggering

jobs:
  build:
    runs-on: ubuntu-latest # Runs on GitHub-hosted Ubuntu

    steps:
      # 1Ô∏è‚É£ CHECKOUT Main Repository
      - name: Clone Main Repository
        uses: actions/checkout@v4
        with:
          repository: ajgorhoe/IGLib.modules.IGLibCore
          path: IGLibCore

      # 2Ô∏è‚É£ CLONE IGLibScripts
      - name: Clone IGLibScripts
        run: |
          git clone --depth 1 https://github.com/ajgorhoe/IGLib.modules.IGLibScripts \
            IGLibScripts

      # 3Ô∏è‚É£ CHECKOUT IGLibScripting
      - name: Clone IGLibScripting
        uses: actions/checkout@v4
        with:
          repository: ajgorhoe/IGLib.modules.IGLibCore
          path: IGLibScripting

      # # 3Ô∏è‚É£ CLONE IGLibScripting 
      # - name: Clone IGLibScripting Dependency
      #   run: |
      #     git clone --depth 1 https://github.com/ajgorhoe/IGLib.modules.IGLibScripting \
      #       IGLibScripting

      # # 3Ô∏è‚É£ CLONE IGLibScripting
      # - name: Clone IGLibScripting
      #   run: |
      #     git clone --depth 1 https://github.com/ajgorhoe/IGLib.modules.IGLibScripting \
      #       IGLibScripting

      # 4Ô∏è‚É£ SET UP .NET SDK
      - name: Setup .NET 8
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: 8.0.x

      # 5Ô∏è‚É£ RESTORE DEPENDENCIES
      - name: Restore NuGet packages
        run: dotnet restore IGLibCore/IGLibCore.sln

      # 6Ô∏è‚É£ RUN a TEST SCRIPT (PowerShell)
      - name: Run Pre-Build PowerShell Script
        run: pwsh -File IGLibCore/scripts/PrintEnv.ps1

      # 7Ô∏è‚É£ BUILD Main Project & Test Project in Release Mode
      - name: Build Solution
        run: dotnet build IGLibCore/IGLibCore.sln --configuration Release --no-restore

      # # 8Ô∏è‚É£ RUN TESTS & COLLECT RESULTS
      # - name: Run Unit Tests
      #   run: dotnet test IGLibCore/test/IGLib.Core.Tests/IGLib.Core.Tests.csproj --configuration Release --logger trx --results-directory test-results
      
      # # üîü RUN POST-BUILD SCRIPT (PowerShell)
      # - name: Run Post-Build PowerShell Script
      #   run: pwsh -File IGLibCore/scripts/PrintEnv.ps1

      # # 1Ô∏è‚É£1Ô∏è‚É£ UPLOAD BUILD OUTPUT (DLLs, EXEs, etc.)
      # - name: Upload Build Artifacts
      #   uses: actions/upload-artifact@v4
      #   with:
      #     name: BuildArtifacts
      #     path: MainReop1/src/MainRepo1/bin/Release/

